<% if user_signed_in? %>
<div class="container mt-5">
  <h2 class="border-bottom topic">トピック詳細</h2>
   <div class=" mt-3">
     <span class="category"><%= @topic.category.name %></span>
       <span class="age"><%= @topic.age.name %></span>
     <h3 class="title mt-3"><%= @topic.title %></h3>
      <p><%= @topic.body %></p>
      <% if @topic.favorited_by?(current_user) %>
      <%= link_to topic_favorites_path(@topic), method: :delete do %>
      ♥<%= @topic.favorites.count %>
      <% end %>
      <% else %>
      <%= link_to topic_favorites_path(@topic), method: :post do %>
      ♡<%= @topic.favorites.count %>
      <% end %>
      <% end %>
       <p class='text-right'>
         <%= link_to user_path(@topic.user) do %>
         <%= attachment_image_tag(@topic.user, :profile_image, :fill, 50, 50, fallback: "no_image.jpg", size: "50x50") %>
         <%= @topic.user.name %>
         <% end %>
         <%= @topic.created_at.strftime('%Y/%m/%d') %>
       </p>



<h2 class="topic">コメント</h2>
  <% @topic.comments.each do |comment| %>
  <table class="table">
    <tr>
      <td><%= link_to user_path(comment.user) do %>
          <%= attachment_image_tag(comment.user, :profile_image, :fill, 50, 50, fallback: "no_image.jpg", size: "50x50") %>
          <%= comment.user.name %><% end %></td>
      <td><%= comment.comment %></td>
      <td> <%= comment.created_at.strftime('%Y/%m/%d') %></td>
      <td><% if comment.user == current_user %>
          <%= link_to "削除", topic_comment_path(comment.topic, comment), method: :delete %>
          <% end %></td>
    </tr><% end %>
  </table>

  <h2 class="topic">コメント投稿</h2>
  <div>
    <%= form_with(model:[@topic, @comment], local: true) do |f| %>
    <%= f.text_area :comment, :size=>"100%",placeholder: "コメントをここに" %>
    <%= f.submit "投稿する" %>
    <% end %>
  </div>
</div>

<% else %>
<div class="container mt-5">
<h2>トピック詳細</h2>
  <table class="table table-bordered">
    <tr>
      <th class="table-active">投稿者</th>
      <td><%= attachment_image_tag(@topic.user, :profile_image, :fill, 50, 50, fallback: "no_image.jpg", size: "50x50") %>
          <%= @topic.user.name %></td>
    </tr>
    <tr>
      <th class="table-active">タイトル</th>
      <td><%= @topic.title %></td>
    </tr>
    <tr>
      <th class="table-active">本文</th>
      <td><%= @topic.body %></td>
    </tr>
    <tr>
      <th class="table-active">投稿日時</th>
      <td><%= @topic.created_at.strftime('%Y/%m/%d') %></td>
    </tr>
    <tr>
      <th class="table-active">コメント件数</th>
      <td><%= @topic.comments.count %></td>
    </tr>
   </table>

<h2>コメント</h2>
  <% @topic.comments.each do |comment| %>
  <table class="table">
    <tr>
      <td><%= link_to user_path(comment.user) do %>
          <%= attachment_image_tag(comment.user, :profile_image, :fill, 50, 50, fallback: "no_image.jpg", size: "50x50") %>
          <%= comment.user.name %><% end %></td>
      <td><%= comment.comment %></td>
      <td> <%= comment.created_at.strftime('%Y/%m/%d') %></td>
      <td><% if comment.user == current_user %>
          <%= link_to "削除", topic_comment_path(comment.topic, comment), method: :delete %>
          <% end %></td>
    </tr><% end %>
  </table>

<h2>コメント投稿</h2>
<div>
  <%= form_with(model:[@topic, @comment], local: true) do |f| %>
  <%= f.text_area :comment, :size=>"100%",placeholder: "コメントをここに" %>
  <%= f.submit "投稿する" %>
  <% end %>
</div>
</div>

<% end %>